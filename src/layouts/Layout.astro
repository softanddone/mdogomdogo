---
// Import your schema functions
import {
  generateProductSchema,
  generateHomepageSchema,
  generatePageSchema,
} from "../utils/structureData";

const {
  title = "Mdogomdogo Deals Kenya | Lipa Mdogo Mdogo Phones Nairobi, Kiambu & Beyond",
  description = "Buy affordable smartphones on Lipa Mdogo Mdogo in Nairobi and Kiambu. Get Samsung, Infinix, Itel, Tecno, and more with home delivery. Pay slowly, own it easily.",
  canonical = "https://mdogomdogodeals.co.ke",
  ogImage = "https://mdogomdogodeals.co.ke/phones/samsung-a15.png",
  ogType = "website",
  ogLocale = "en_KE",
  twitterCard = "summary_large_image",
  product, // For individual product pages
  products, // For homepage with multiple products
  pageType, // 'product' | 'homepage' | 'other'
  schema, // Optional: pre-generated schema
} = Astro.props;

const keywords = [
  "lipa mdogo mdogo phones",
  "simu za kulipa polepole",
  "affordable smartphones",
  "cheap smartphones",
  "get smartphones in nairobi",
  "m-kopa",
  "watu",
  "ulephone",
  "chukua simu lipa polepole",
  "cheap samsung",
  "affordable samsung",
  "hmd phone",
  "mkopa phone",
  "watu phones online",
  "phone online delivery",
  "samsung lipa mdogo mdogo",
  "itel lipa mdogo mdogo",
  "infinix lipa mdogo mdogo",
  "buy phone on credit in kenya",
  "phone lipa polepole",
  "simu kwa malipo polepole",
  "phones for sale in nairobi",
  "budget phones kenya",
  "cheap android phones nairobi",
  "phones with delivery",
  "lipa mdogo mdogo nairobi",
  "kiambu phone offers",
  "installment phones kenya",
].join(", ");

// Generate appropriate schema based on page type
let generatedSchema = "";

if (schema) {
  // Use pre-generated schema if provided
  generatedSchema = schema;
} else if (pageType === "product" && product) {
  // Generate product schema for individual product pages
  generatedSchema = generateProductSchema(product);
} else if (pageType === "homepage" && products) {
  // Generate homepage schema for pages with multiple products
  generatedSchema = generateHomepageSchema(products);
} else if (product) {
  // Fallback: if product exists but no pageType specified
  generatedSchema = generateProductSchema(product);
} else if (products) {
  // Fallback: if products exist but no pageType specified
  generatedSchema = generateHomepageSchema(products);
}
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />

    <!-- Canonical -->
    <link rel="canonical" href={canonical} />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={ogType} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:locale" content={ogLocale} />
    <meta property="og:url" content={canonical} />

    <!-- Twitter Card -->
    <meta name="twitter:card" content={twitterCard} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <!-- JSON-LD Structured Data -->
    {
      generatedSchema && (
        <script type="application/ld+json" set:html={generatedSchema} />
      )
    }

    <!-- Optional: custom head content from page -->
    <slot name="head" />

    <style>
      :global(html),
      :global(body) {
        margin: 0;
        padding: 0;
        max-width: 100vw;
      }

      html,
      body {
        max-width: 100vw;
        overflow-x: hidden;
        /* background: #fffaf0; */
        background: #fef5e7;
      }

      :global(*) {
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <slot />
  </body>
</html>
