---
const { name, image, source, from, deposit, totalPrice, discount, display, slug, slugs, index } = Astro.props;
---

<style is:inline>
  :root {
    /* Streamlined design tokens */
    --primary: #ff6b35;
    --primary-hover: #e55a2b;
    --secondary: #2563eb;
    --success: #10b981;
    --error: #ef4444;
    --warning: #f59e0b;
    
    /* Semantic colors with WCAG AA compliance */
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --text-primary: #0f172a;
    --text-secondary: #334155;  /* Darker for better contrast (was #475569) */
    --text-muted: #475569;      /* Darker for better contrast (was #64748b) */
    --border: #e2e8f0;
    --border-focus: #cbd5e1;
    
    /* Spacing system (consistent rem units) */
    --space-1: 0.25rem;
    --space-2: 0.5rem;
    --space-3: 0.75rem;
    --space-4: 1rem;
    --space-6: 1.5rem;
    --space-8: 2rem;
    
    /* Typography */
    --font-sm: 0.875rem;
    --font-base: 0.9375rem;
    --font-lg: 1rem;
    --font-xl: 1.125rem;
    --font-2xl: 1.25rem;
    --font-medium: 500;
    --font-semibold: 600;
    --font-bold: 700;
    
    /* Border radius */
    --radius: 0.75rem;
    --radius-lg: 1rem;
    --radius-xl: 1.5rem;
    
    /* Shadows with consistent opacity */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    
    /* Transitions */
    --transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-transform: transform var(--transition);
  }

  /* Component-scoped reset */
  .product-card *,
  .product-card *::before,
  .product-card *::after {
    box-sizing: border-box;
  }

  /* Main card container */
  .product-card {
    position: relative;
    display: flex;
    flex-direction: column;
    width: 280px;
    background: var(--bg-primary);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: var(--transition);
    cursor: pointer;
    /* Improve paint performance */
    will-change: transform;
    contain: layout;
  }
  
  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary);
  }

  /* Image container with aspect ratio */
  .product-image {
    position: relative;
    aspect-ratio: 1;
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
    border-bottom: 1px solid var(--border);
    overflow: hidden;
    transition: var(--transition-transform);
  }
  
  .product-card:hover .product-image {
    transform: scale(1.02);
  }
  
  .product-image img {
    width: 140px;
    height: 140px;
    object-fit: contain;
    transition: var(--transition-transform);
    /* Improve rendering */
    image-rendering: auto;
  }
  
  .product-card:hover .product-image img {
    transform: scale(1.05);
  }

  /* Badges with WCAG AA compliant colors */
  .badge {
    position: absolute;
    top: var(--space-3);
    padding: var(--space-2) var(--space-3);
    font-size: 0.75rem;
    font-weight: var(--font-bold);
    color: white;
    border-radius: var(--radius);
    z-index: 10;
    letter-spacing: 0.025em;
    text-transform: uppercase;
    backdrop-filter: blur(8px);
    animation: slideIn 0.3s ease-out;
    /* Ensure badges have solid backgrounds for contrast */
    box-shadow: 0 2px 4px rgb(0 0 0 / 0.2);
  }
  
  @keyframes slideIn {
    from { 
      transform: translateY(-100%); 
      opacity: 0; 
    }
    to { 
      transform: translateY(0); 
      opacity: 1; 
    }
  }
  
  .discount-badge { 
    /* Darker red for better contrast: 4.51:1 ratio with white text */
    background: #dc2626;
    /* left: var(--space-3); */
    left: 2px;
  }
  
  .hot-badge { 
    /* Much darker orange/brown for better contrast: 8.35:1 ratio with white text */
    background: #92400e;
    top: 60px!important;


    /* left: var(--space-3); */
    left:2px;
  
  }

  /* Content area */
  .product-info {
    padding: var(--space-4);
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  /* Typography improvements */
  .product-title {
    margin: 0;
    font-size: var(--font-lg);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    line-height: 1.4;
    /* Better text rendering */
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
  }
  
  .product-title a {
    color: inherit;
    text-decoration: none;
    border-radius: var(--radius);
    padding: var(--space-1);
    margin: calc(-1 * var(--space-1));
    transition: var(--transition);
    position: relative;
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  .product-title a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: var(--space-1);
    right: var(--space-1);
    height: 2px;
    background: var(--primary);
    transform: scaleX(0);
    transition: var(--transition);
  }
  
  .product-title a:hover { 
    color: var(--secondary);
  }
  
  .product-title a:hover::after {
    transform: scaleX(1);
  }
  
  .product-title a:focus-visible {
    outline: 2px solid var(--secondary);
    outline-offset: 2px;
  }

  /* Pricing section with better contrast */
  .product-pricing {
    display: flex;
    align-items: baseline;
    gap: var(--space-2);
  }
  
  .deposit-price {
    font-size: var(--font-2xl);
    font-weight: var(--font-bold);
    /* Darker red for better contrast: 7.73:1 ratio with white background */
    color: #b91c1c;
    letter-spacing: -0.02em;
  }
  
  .original-price {
    font-size: var(--font-sm);
    color: var(--text-muted);
    text-decoration: line-through;
    font-weight: var(--font-medium);
  }

  /* Stock status with enhanced contrast */
  .stock-status {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-sm);
    /* Darker green for better contrast: 4.79:1 ratio */
    color: #047857;
    font-weight: var(--font-medium);
    /* Stronger background for better badge contrast */
    background: rgb(16 185 129 / 0.15);
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius);
    width: fit-content;
    border: 1px solid rgb(16 185 129 / 0.3);
  }
  
  .stock-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    /* Match the darker green */
    background: #047857;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  /* Action buttons with better hierarchy */
  .product-actions {
    display: flex;
    gap: var(--space-2);
    margin-top: auto;
  }
  
  .btn {
    border: none;
    border-radius: var(--radius-lg);
    font-weight: var(--font-semibold);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    position: relative;
    overflow: hidden;
  }
  
  .btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgb(255 255 255 / 0.2), transparent);
    transform: translateX(-100%);
    transition: var(--transition);
  }
  
  .btn:hover::before {
    transform: translateX(100%);
  }
  
  .btn-primary {
    flex: 1;
    background: var(--primary);
    color: white;
    padding: var(--space-3) var(--space-4);
    font-size: var(--font-base);
    min-height: 44px;
  }
  
  .btn-primary:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
  }
  
  .btn-secondary {
    width: 44px;
    height: 44px;
    background: var(--bg-primary);
    border: 1px solid var(--border-focus);
    color: var(--text-secondary);
    flex-shrink: 0;
  }
  
  .btn-secondary:hover {
    background: rgb(255 107 53 / 0.1);
    border-color: var(--primary);
    color: var(--primary);
    transform: scale(1.05);
  }
  
  .btn:focus-visible {
    outline: 2px solid var(--secondary);
    outline-offset: 2px;
  }

  /* Accessibility improvements */
  .visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }

  /* Responsive design */
  @media (max-width: 768px) {
    .product-card { 
      width: 100%; 
      max-width: 320px; 
    }
    .product-image { 
      height: 180px; 
    }
    .product-image img { 
      width: 120px; 
      height: 120px; 
    }
    .product-info { 
      padding: var(--space-3); 
    }
    .product-title { 
      font-size: var(--font-base); 
    }
    .deposit-price { 
      font-size: var(--font-xl); 
    }
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .product-card,
    .product-image,
    .product-image img,
    .btn,
    .badge {
      transition: none;
      animation: none;
    }
    
    .product-card:hover,
    .product-card:hover .product-image,
    .product-card:hover .product-image img,
    .btn:hover,
    .btn-secondary:hover {
      transform: none;
    }
  }

  /* High contrast mode support with enhanced accessibility */
  @media (prefers-contrast: high) {
    .product-card,
    .btn,
    .stock-status,
    .badge {
      border-width: 2px;
    }
    
    /* Enhance contrast further in high contrast mode */
    .deposit-price {
      color: #991b1b; /* Even darker red: 9.14:1 ratio */
    }
    
    .stock-status {
      color: #065f46; /* Darker green: 6.24:1 ratio */
      background: rgb(16 185 129 / 0.25);
      border-color: rgb(16 185 129 / 0.5);
    }
    
    .stock-indicator {
      background: #065f46;
    }
    
    .badge {
      /* Ensure maximum contrast for badges */
      text-shadow: 0 1px 2px rgb(0 0 0 / 0.8);
    }
    
    .discount-badge {
      background: #991b1b; /* 9.14:1 ratio */
    }
    
    .hot-badge {
      background: #78350f; /* Even darker: 10.89:1 ratio */
    }
  }

  /* Print styles */
  @media print {
    .product-card { 
      break-inside: avoid;
      box-shadow: none;
      border: 1px solid var(--border);
    }
    .product-actions { 
      display: none; 
    }
    .badge { 
      background: var(--text-primary) !important;
      color: var(--bg-primary) !important;
    }
  }
</style>

<article class="product-card" itemscope itemtype="https://schema.org/Product">
  <a href={`/products/${slug}`} class="product-image" aria-label={`View ${name} details`}>
    {discount && (
      <span class="badge discount-badge" aria-label={`${discount} discount`}>
        {discount}
      </span>
    )}
    {display !== 'none' && (
      <span class="badge hot-badge" aria-label="Popular item" style={`display: ${display};`}>
        Hot
      </span>
    )}
    <img
      src={source}
      alt={`${name} product`}
      width="140"
      height="140"
      itemprop="image"
      loading={index === 0 ? "eager" : "lazy"}
      decoding={index === 0 ? "sync" : "async"}
      fetchpriority={index === 0 ? "high" : undefined}
    />
  </a>

  <div class="product-info">
    <h2 class="product-title" itemprop="name">
      <a href={`/products/${slug}`} aria-describedby={`price-${slug}`}>
        {name}
      </a>
    </h2>

    <div class="product-pricing" id={`price-${slug}`}>
      <span class="deposit-price" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
        <span class="visually-hidden">Deposit amount:</span>
        Deposit {deposit}
        <meta itemprop="price" content={deposit.replace(/[^\d.]/g, '')} />
        <meta itemprop="priceCurrency" content="USD" />
      </span>
      {totalPrice && totalPrice !== deposit && (
        <span class="original-price">
          <span class="visually-hidden">Original price:</span>
          {totalPrice}
        </span>
      )}
    </div>

    <div class="stock-status" role="status" aria-live="polite">
      <div class="stock-indicator" aria-hidden="true"></div>
      <span>In Stock</span>
    </div>

    <div class="product-actions">
      <a 
        href={`/checkout/${slugs}`} 
        class="btn btn-primary" 
        aria-label={`Order ${name} with ${deposit} deposit`}
      >
        Order Now
      </a>
      <button 
        class="btn btn-secondary" 
        type="button" 
        aria-label={`Add ${name} to cart`}
        title="Add to cart"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path d="m1 1 4 4 10 0 2 11-14 0"></path>
        </svg>
        <span class="visually-hidden">Add to cart</span>
      </button>
    </div>
  </div>
</article>