---
// CarouselComponent.astro
---

<style is:inline>
  .carousel-wrapper-unique-xyz {
    width: 100%;
    overflow: hidden;
    position: relative;
    margin-top: -100px !important;
    z-index: 0 !important;
  }

  .carousel-wrapper-unique-xyz * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .carousel-wrapper-unique-xyz .gradient-orb-1 {
    position: absolute;
    top: 25%;
    left: 25%;
    width: 384px;
    height: 384px;
    background: #bfdbfe;
    border-radius: 50%;
    mix-blend-mode: multiply;
    filter: blur(64px);
    opacity: 0.3;
    animation: carousel-pulse-xyz 4s ease-in-out infinite;
    pointer-events: none;
  }

  .carousel-wrapper-unique-xyz .gradient-orb-2 {
    position: absolute;
    top: 33%;
    right: 25%;
    width: 384px;
    height: 384px;
    background: #c7d2fe;
    border-radius: 50%;
    mix-blend-mode: multiply;
    filter: blur(64px);
    opacity: 0.3;
    animation: carousel-pulse-xyz 4s ease-in-out infinite;
    animation-delay: 2s;
    pointer-events: none;
  }

  @keyframes carousel-pulse-xyz {
    0%,
    100% {
      opacity: 0.3;
    }
    50% {
      opacity: 0.4;
    }
  }

  .carousel-wrapper-unique-xyz .hero-section {
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 80px;
    padding-bottom: 80px;
    z-index: 1;
    overflow: visible;
  }

  .carousel-wrapper-unique-xyz .carousel-container {
    position: relative;
    width: 100%;
    max-width: 100vw;
    min-height: 650px;
    perspective: 2000px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: visible;
  }

  .carousel-wrapper-unique-xyz .carousel {
    position: relative;
    width: 350px;
    height: 550px;
    transform-style: preserve-3d;
  }

  .carousel-wrapper-unique-xyz .phone-card {
    position: absolute;
    width: 320px;
    height: 480px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 24px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 40px 30px;
    transition: all 1.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    backface-visibility: hidden;
    cursor: pointer;
    border: 1px solid rgba(219, 234, 254, 0.6);
    will-change: transform, opacity;
    transform-style: preserve-3d;
  }

  .carousel-wrapper-unique-xyz .phone-image-container {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0;
  }

  .carousel-wrapper-unique-xyz .phone-mockup {
    width: 200px;
    height: 200px;
    background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);
    border-radius: 30px;
    position: relative;
    box-shadow: 0 20px 60px rgba(37, 99, 235, 0.3);
    border: 8px solid #f3f4f6;
    overflow: hidden;
  }

  .carousel-wrapper-unique-xyz .phone-mockup-pink {
    background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
    box-shadow: 0 20px 60px rgba(236, 72, 153, 0.3);
  }

  .carousel-wrapper-unique-xyz .phone-mockup-cyan {
    background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
    box-shadow: 0 20px 60px rgba(6, 182, 212, 0.3);
  }

  .carousel-wrapper-unique-xyz .phone-mockup-amber {
    background: linear-gradient(135deg, #f59e0b 0%, #eab308 100%);
    box-shadow: 0 20px 60px rgba(245, 158, 11, 0.3);
  }

  .carousel-wrapper-unique-xyz .phone-mockup-emerald {
    background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
    box-shadow: 0 20px 60px rgba(16, 185, 129, 0.3);
  }

  .carousel-wrapper-unique-xyz .phone-notch {
    width: 100px;
    height: 25px;
    background: #1f2937;
    border-radius: 0 0 15px 15px;
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    display: none;
  }

  .carousel-wrapper-unique-xyz .phone-screen {
    width: 100%;
    height: 100%;
    border-radius: 22px;
    background: linear-gradient(180deg, #3b82f6 0%, #6366f1 50%, #8b5cf6 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
  }

  .carousel-wrapper-unique-xyz .phone-screen img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    display: block;
  }

  .carousel-wrapper-unique-xyz .phone-info {
    text-align: center;
  }

  .carousel-wrapper-unique-xyz .phone-name {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 8px;
    background: linear-gradient(to right, #2563eb, #4f46e5);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .carousel-wrapper-unique-xyz .phone-tagline {
    font-size: 14px;
    /* color: #6b7280; */
    color: black !important;
    margin-bottom: 15px;
  }

  .carousel-wrapper-unique-xyz .phone-price {
    font-size: 24px;
    font-weight: 600;
    color: #f59e0b !important;
  }

  .carousel-wrapper-unique-xyz .phone-card.pos-0 {
    transform: translateX(-500px) translateZ(-400px) rotateY(25deg) scale(0.7) !important;
    opacity: 0.3 !important;
    z-index: 1 !important;
  }

  .carousel-wrapper-unique-xyz .phone-card.pos-1 {
    transform: translateX(-220px) translateZ(-150px) rotateY(18deg) scale(0.82) !important;
    opacity: 0.6 !important;
    z-index: 2 !important;
  }

  .carousel-wrapper-unique-xyz .phone-card.pos-2 {
    transform: translateX(0) translateZ(200px) rotateY(0deg) scale(1) !important;
    opacity: 1 !important;
    z-index: 3 !important;
    box-shadow: 0 30px 80px rgba(37, 99, 235, 0.15) !important;
  }

  .carousel-wrapper-unique-xyz .phone-card.pos-3 {
    transform: translateX(220px) translateZ(-150px) rotateY(-18deg) scale(0.82) !important;
    opacity: 0.6 !important;
    z-index: 2 !important;
  }

  .carousel-wrapper-unique-xyz .phone-card.pos-4 {
    transform: translateX(500px) translateZ(-400px) rotateY(-25deg) scale(0.7) !important;
    opacity: 0.3 !important;
    z-index: 1 !important;
  }

  .carousel-wrapper-unique-xyz .navigation {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 10;
  }

  .carousel-wrapper-unique-xyz .nav-btn {
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border: 2px solid #dbeafe;
    border-radius: 50%;
    color: #2563eb;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
  }

  .carousel-wrapper-unique-xyz .nav-btn:hover {
    background: rgba(255, 255, 255, 1);
    border-color: #2563eb;
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(37, 99, 235, 0.2);
  }

  .carousel-wrapper-unique-xyz .nav-btn:active {
    transform: scale(0.95);
    transition: all 0.2s ease;
  }

  @media (max-width: 768px) {
    .carousel-wrapper-unique-xyz .carousel-container {
      min-height: 550px;
    }

    .carousel-wrapper-unique-xyz .carousel {
      width: 250px;
      height: 450px;
    }

    .carousel-wrapper-unique-xyz .phone-card {
      width: 240px;
      height: 420px;
      padding: 30px 20px;
    }

    .carousel-wrapper-unique-xyz .phone-mockup {
      width: 180px;
      height: 180px;
    }

    .carousel-wrapper-unique-xyz .phone-card.pos-0 {
      transform: translateX(-320px) translateZ(-300px) rotateY(25deg)
        scale(0.65) !important;
    }

    .carousel-wrapper-unique-xyz .phone-card.pos-1 {
      transform: translateX(-140px) translateZ(-100px) rotateY(18deg)
        scale(0.78) !important;
    }

    .carousel-wrapper-unique-xyz .phone-card.pos-2 {
      transform: translateX(0) translateZ(150px) rotateY(0deg) scale(1) !important;
    }

    .carousel-wrapper-unique-xyz .phone-card.pos-3 {
      transform: translateX(140px) translateZ(-100px) rotateY(-18deg)
        scale(0.78) !important;
    }

    .carousel-wrapper-unique-xyz .phone-card.pos-4 {
      transform: translateX(320px) translateZ(-300px) rotateY(-25deg)
        scale(0.65) !important;
    }

    .carousel-wrapper-unique-xyz .phone-name,
    .carousel-wrapper-unique-xyz .phone-price {
      font-size: 15px;
    }
  }
</style>

<div class="carousel-wrapper-unique-xyz">
  <div class="gradient-orb-1"></div>
  <div class="gradient-orb-2"></div>

  <main class="hero-section">
    <div class="carousel-container">
      <section
        class="carousel"
        id="carousel"
        role="region"
        aria-label="Simu za Lipa Mdogo Mdogo Collection"
      >
        <article class="phone-card pos-0" data-position="0">
          <div class="phone-image-container">
            <div class="phone-mockup">
              <div class="phone-notch"></div>
              <div class="phone-screen">
                <img
                  src="/phones/2.jpeg"
                  alt="Samsung A07 - Lipa Mdogo Mdogo Phone"
                  loading="lazy"
                />
              </div>
            </div>
          </div>
          <div class="phone-info">
            <h2 class="phone-name">Samsung A07</h2>
            <p class="phone-tagline">Lipa Pole Pole</p>
            <p class="phone-price">Deposit Ksh 4200</p>
          </div>
        </article>

        <article class="phone-card pos-1" data-position="1">
          <div class="phone-image-container">
            <div class="phone-mockup phone-mockup-pink">
              <div class="phone-notch"></div>
              <div class="phone-screen">
                <img
                  src="/phones/3.jpeg"
                  alt="Infinix Hot60i - Lipa Mos Mos"
                  loading="lazy"
                />
              </div>
            </div>
          </div>
          <div class="phone-info">
            <h2 class="phone-name">Infinix Hot60i</h2>
            <p class="phone-tagline">Lipa Pole</p>
            <p class="phone-price">Deposit Ksh 4500</p>
          </div>
        </article>

        <article class="phone-card pos-2" data-position="2">
          <div class="phone-image-container">
            <div class="phone-mockup phone-mockup-cyan">
              <div class="phone-notch"></div>
              <div class="phone-screen">
                <img
                  src="/phones/4.jpeg"
                  alt="Infinix Hot60i Pro - Simu za Lipa Mdogo Mdogo"
                  loading="lazy"
                />
              </div>
            </div>
          </div>
          <div class="phone-info">
            <h2 class="phone-name">Infinix Hot60i Pro</h2>
            <p class="phone-tagline">Lipa Mos Mos</p>
            <p class="phone-price">Deposit Ksh 6800</p>
          </div>
        </article>

        <article class="phone-card pos-3" data-position="3">
          <div class="phone-image-container">
            <div class="phone-mockup phone-mockup-amber">
              <div class="phone-notch"></div>
              <div class="phone-screen">
                <img
                  src="/phones/1.jpeg"
                  alt="Tecno Spark 40 Pro - Lipa Mdogo Mdogo Phones"
                  loading="lazy"
                />
              </div>
            </div>
          </div>
          <div class="phone-info">
            <h2 class="phone-name">Tecno Spark 40 Pro</h2>
            <p class="phone-tagline">Lipa Mdogo Mdogo</p>
            <p class="phone-price">Deposit Ksh 6000</p>
          </div>
        </article>

        <article class="phone-card pos-4" data-position="4">
          <div class="phone-image-container">
            <div class="phone-mockup phone-mockup-emerald">
              <div class="phone-notch"></div>
              <div class="phone-screen">
                <img
                  src="/phones/5.jpeg"
                  alt="Tecno Spark 40 - Samsung A05 Alternative"
                  loading="lazy"
                />
              </div>
            </div>
          </div>
          <div class="phone-info">
            <h2 class="phone-name">Tecno Spark 40</h2>
            <p class="phone-tagline">Lipa Mdogo Mdogo</p>
            <p class="phone-price">Deposit Ksh 3900</p>
          </div>
        </article>
      </section>

      <nav class="navigation" aria-label="Carousel navigation">
        <button class="nav-btn" id="prevBtn" aria-label="Previous phone"
          >&lsaquo;</button
        >
        <button class="nav-btn" id="nextBtn" aria-label="Next phone"
          >&rsaquo;</button
        >
      </nav>
    </div>
  </main>
</div>

<script>
  (function () {
    "use strict";

    if (window.carouselInitialized) return;
    window.carouselInitialized = true;

    function initCarousel() {
      const cards = document.querySelectorAll(".phone-card");
      const nextBtn = document.getElementById("nextBtn");
      const prevBtn = document.getElementById("prevBtn");
      const carousel = document.getElementById("carousel");

      if (!cards.length || !nextBtn || !prevBtn || !carousel) {
        return;
      }

      let currentPositions = [0, 1, 2, 3, 4];
      let autoRotateInterval = null;
      let isAnimating = false;

      function updateCardPositions() {
        requestAnimationFrame(() => {
          cards.forEach((card, index) => {
            const pos = currentPositions[index];
            if (card.getAttribute("data-position") !== String(pos)) {
              card.className = `phone-card pos-${pos}`;
              card.setAttribute("data-position", pos);
            }
          });
          isAnimating = false;
        });
      }

      function rotateNext() {
        if (isAnimating) return;
        isAnimating = true;
        currentPositions = currentPositions.map((pos) => (pos + 1) % 5);
        updateCardPositions();
      }

      function rotatePrev() {
        if (isAnimating) return;
        isAnimating = true;
        currentPositions = currentPositions.map((pos) => (pos - 1 + 5) % 5);
        updateCardPositions();
      }

      function startAutoRotate() {
        if (autoRotateInterval) return;
        autoRotateInterval = setInterval(rotateNext, 6000);
      }

      function stopAutoRotate() {
        if (autoRotateInterval) {
          clearInterval(autoRotateInterval);
          autoRotateInterval = null;
        }
      }

      function resetAutoRotate() {
        stopAutoRotate();
        startAutoRotate();
      }

      nextBtn.addEventListener(
        "click",
        () => {
          rotateNext();
          resetAutoRotate();
        },
        { passive: true }
      );

      prevBtn.addEventListener(
        "click",
        () => {
          rotatePrev();
          resetAutoRotate();
        },
        { passive: true }
      );

      cards.forEach((card) => {
        card.addEventListener(
          "click",
          () => {
            const currentPos = parseInt(card.getAttribute("data-position"));
            if (currentPos === 2 || isAnimating) return;

            let steps = 2 - currentPos;
            if (steps < 0) steps += 5;

            isAnimating = true;
            for (let i = 0; i < steps; i++) {
              setTimeout(() => {
                currentPositions = currentPositions.map((pos) => (pos + 1) % 5);
                updateCardPositions();
              }, i * 200);
            }

            setTimeout(() => {
              isAnimating = false;
              resetAutoRotate();
            }, steps * 200);
          },
          { passive: true }
        );
      });

      startAutoRotate();

      carousel.addEventListener("mouseenter", stopAutoRotate, {
        passive: true,
      });
      carousel.addEventListener("mouseleave", startAutoRotate, {
        passive: true,
      });

      window.addEventListener("beforeunload", stopAutoRotate);
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initCarousel);
    } else {
      initCarousel();
    }
  })();
</script>
