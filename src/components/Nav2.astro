---
import HeadText from "./HeadText.astro";
import PopularBrands from "./PopularBrands.astro";
---

<nav class="navbar" role="navigation" aria-label="Main navigation">
  <!-- Top Section -->
  <div class="navbar-top">
    <div class="container">
      <button
        class="menu-btn"
        id="menuBtn"
        aria-label="Open navigation menu"
        aria-expanded="false"
        aria-controls="mobileMenu"
      >
        <span class="hamburger" aria-hidden="true"></span>
        <span class="hamburger" aria-hidden="true"></span>
        <span class="hamburger" aria-hidden="true"></span>
      </button>

      <div class="logo">
        <a
          href="/"
          aria-label="Mdogo Mdogo Deals - Lipa Mdogo Mdogo Phones in Nairobi"
        >
          <div class="logo-img">
            <img src="/phones/y2.png" alt="Mdogo Mdogo Deals Logo" />
          </div>
        </a>
      </div>

      <div class="search-container" role="search">
        <label for="searchInput" class="visually-hidden"
          >Search phones on credit - Lipa Mdogo Mdogo</label
        >
        <div class="search-input-wrapper">
          <input
            type="search"
            class="search-input"
            id="searchInput"
            name="q"
            placeholder=" "
            aria-label="Search for phones on credit in Nairobi"
            autocomplete="off"
            aria-autocomplete="list"
            aria-controls="searchResults"
          />
          <span class="fake-placeholder" id="fakePlaceholder"
            >Search phones on Credit...</span
          >
        </div>
        <button
          class="search-btn"
          id="searchBtn"
          aria-label="Search lipa mdogo mdogo phones"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
            focusable="false"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
        <div
          class="search-results"
          id="searchResults"
          role="listbox"
          aria-label="Search results"
        >
        </div>
      </div>

      <div class="top-actions">
        <a
          href="tel:+254722867659"
          class="phone-link"
          aria-label="Call us at 254 722 867 659"
        >
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
            focusable="false"
          >
            <path
              d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
            ></path>
          </svg>
          <span class="phone-number">254 722 867 659</span>
        </a>

        <div
          class="delivery-badge"
          role="status"
          aria-label="Free delivery in Nairobi"
        >
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
            focusable="false"
          >
            <rect x="1" y="3" width="15" height="13"></rect>
            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
            <circle cx="5.5" cy="18.5" r="2.5"></circle>
            <circle cx="18.5" cy="18.5" r="2.5"></circle>
          </svg>
          <span>Free Delivery Nairobi</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Section -->
  <div class="navbar-bottom">
    <div class="container">
      <ul class="nav-menu" id="navMenu" role="menubar">
        <li role="none">
          <a href="/" class="active" role="menuitem" aria-current="page">Home</a
          >
        </li>
        <li role="none">
          <a
            href="/iphone"
            role="menuitem"
            title="iPhone lipa mdogo mdogo prices">iPhone Deals</a
          >
        </li>
        <li role="none">
          <a
            href="/samsung"
            role="menuitem"
            title="Samsung lipa pole pole phones">Samsung Phones</a
          >
        </li>
        <li role="none">
          <a href="/infinix" role="menuitem" title="Infinix lipa mdogo mdogo"
            >Infinix Mobile Phones</a
          >
        </li>
        <li role="none">
          <a href="/tecno" role="menuitem" title="Tecno phones on credit"
            >Tecno Smartphones</a
          >
        </li>
        <li role="none">
          <a
            href="/hmd"
            role="menuitem"
            title="HMD phones chukua simu lipa pole pole">HMD Phones</a
          >
        </li>
        <li role="none">
          <a
            href="/tv/televisions"
            role="menuitem"
            title="Smart TVs on credit in Nairobi">Smart TVs</a
          >
        </li>
      </ul>

      <div class="search-container search-mobile" role="search">
        <label for="searchInputMobile" class="visually-hidden"
          >Search phones on credit - Lipa Mdogo Mdogo</label
        >
        <div class="search-input-wrapper">
          <input
            type="search"
            class="search-input"
            id="searchInputMobile"
            name="q"
            placeholder=" "
            aria-label="Search for phones on credit in Nairobi"
            autocomplete="off"
            aria-autocomplete="list"
            aria-controls="searchResultsMobile"
          />
          <span class="fake-placeholder" id="fakePlaceholderMobile"
            >Search phones on credit...</span
          >
        </div>
        <button
          class="search-btn"
          id="searchBtnMobile"
          aria-label="Search lipa mdogo mdogo phones"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
            focusable="false"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
        <div
          class="search-results"
          id="searchResultsMobile"
          role="listbox"
          aria-label="Search results"
        >
        </div>
      </div>

      <button
        class="cart-btn"
        id="cartBtn"
        aria-label="View shopping cart with 0 items"
      >
        <a class="cart-link">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
            focusable="false"
          >
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path
              d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
            ></path>
          </svg>
        </a>

        <span class="cart-count" id="cart-count" aria-live="polite">0</span>
        <span class="cart-total" id="cart-total" aria-live="polite">0</span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <aside
    class="mobile-menu"
    id="mobileMenu"
    aria-label="Mobile navigation menu"
    aria-hidden="true"
  >
    <div class="mobile-menu-header">
      <h2 class="mobile-menu-title">Menu</h2>
      <button
        class="close-btn"
        id="closeBtn"
        aria-label="Close navigation menu"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          aria-hidden="true"
          focusable="false"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <nav aria-label="Mobile primary navigation">
      <ul class="mobile-nav-links">
        <li><a href="/">Home</a></li>
        <li>
          <a href="/iphone" title="iPhone lipa mdogo mdogo prices"
            >iPhone Deals</a
          >
        </li>
        <li>
          <a href="/samsung" title="Samsung lipa pole pole phones"
            >Samsung Phones</a
          >
        </li>
        <li>
          <a href="/tecno" title="Tecno phones on credit">Tecno Smartphones</a>
        </li>
        <li>
          <a href="/infinix" title="Infinix lipa mdogo mdogo"
            >Infinix Mobile Phones</a
          >
        </li>
        <li>
          <a href="/hmd" title="HMD phones chukua simu lipa pole pole"
            >HMD Phones</a
          >
        </li>
        <li>
          <a href="/tv/televisions" title="Smart TVs on credit in Nairobi"
            >Smart TVs</a
          >
        </li>
      </ul>
    </nav>
  </aside>
</nav>

<style is:global>
  :root {
    --brand: #f59e0b;
    --dark: #1f2937;
    --gray: #6b7280;
    --light: #f9fafb;
    --radius: 10px;
    --transition: 0.3s ease;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .cart-total {
    display: none;
  }

  .cart-link {
    text-decoration: none;
  }

  .logo-img {
    width: 50px;
    height: 50px;
    overflow: hidden;
  }

  .logo-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Visually hidden but accessible to screen readers */
  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  .navbar {
    position: sticky;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid #e5e7eb;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    z-index: 1000;
  }

  .container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  /* Logo */
  .logo a {
    text-decoration: none;
    display: inline-block;
  }

  /* Search */
  .search-container {
    flex: 1;
    max-width: 480px;
    position: relative;
  }

  .search-input-wrapper {
    position: relative;
    width: 100%;
  }

  .search-input {
    width: 100%;
    padding: 12px 48px 12px 16px;
    border: 1.5px solid #d1d5db;
    border-radius: var(--radius);
    font-size: 14px;
    transition: var(--transition);
  }

  .search-input:focus {
    border-color: var(--brand);
    box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
    outline: none;
  }

  /* Hide real placeholder */
  .search-input::placeholder {
    opacity: 0;
  }

  /* Fake placeholder styling */
  .fake-placeholder {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
    font-size: 14px;
    pointer-events: none;
    white-space: nowrap;
    transition: opacity 0.2s ease;
  }

  /* Hide fake placeholder when input has focus or value */
  .search-input:focus ~ .fake-placeholder,
  .search-input:not(:placeholder-shown) ~ .fake-placeholder {
    opacity: 0;
  }

  /* Animation 1: Bounce from top with elastic effect */
  @keyframes bounceInFromTop {
    0% {
      opacity: 0;
      transform: translateY(-50%) translateY(-40px) scale(0.8);
    }
    50% {
      opacity: 0.8;
      transform: translateY(-50%) translateY(10px) scale(1.05);
    }
    70% {
      transform: translateY(-50%) translateY(-5px) scale(0.98);
    }
    85% {
      transform: translateY(-50%) translateY(3px) scale(1.01);
    }
    100% {
      opacity: 1;
      transform: translateY(-50%) translateY(0) scale(1);
    }
  }

  @keyframes bounceOutToBottom {
    0% {
      opacity: 1;
      transform: translateY(-50%) translateY(0) scale(1);
    }
    30% {
      opacity: 0.7;
      transform: translateY(-50%) translateY(-5px) scale(1.02);
    }
    100% {
      opacity: 0;
      transform: translateY(-50%) translateY(35px) scale(0.9);
    }
  }

  /* Animation 2: Slide and fade from left */
  @keyframes slideInFromLeft {
    0% {
      opacity: 0;
      transform: translateY(-50%) translateX(-50px) rotate(-5deg);
    }
    60% {
      opacity: 1;
      transform: translateY(-50%) translateX(10px) rotate(2deg);
    }
    80% {
      transform: translateY(-50%) translateX(-5px) rotate(-1deg);
    }
    100% {
      opacity: 1;
      transform: translateY(-50%) translateX(0) rotate(0deg);
    }
  }

  @keyframes slideOutToRight {
    0% {
      opacity: 1;
      transform: translateY(-50%) translateX(0) rotate(0deg);
    }
    100% {
      opacity: 0;
      transform: translateY(-50%) translateX(50px) rotate(5deg);
    }
  }

  /* Animation 3: Scale and pop effect */
  @keyframes scalePopIn {
    0% {
      opacity: 0;
      transform: translateY(-50%) scale(0.3) rotate(-10deg);
    }
    50% {
      opacity: 0.9;
      transform: translateY(-50%) scale(1.15) rotate(3deg);
    }
    70% {
      transform: translateY(-50%) scale(0.95) rotate(-2deg);
    }
    85% {
      transform: translateY(-50%) scale(1.03) rotate(1deg);
    }
    100% {
      opacity: 1;
      transform: translateY(-50%) scale(1) rotate(0deg);
    }
  }

  @keyframes scalePopOut {
    0% {
      opacity: 1;
      transform: translateY(-50%) scale(1) rotate(0deg);
    }
    50% {
      opacity: 0.5;
      transform: translateY(-50%) scale(1.1) rotate(-5deg);
    }
    100% {
      opacity: 0;
      transform: translateY(-50%) scale(0.3) rotate(10deg);
    }
  }

  /* Apply animations to fake placeholder */
  .fake-placeholder.animation-1-in {
    animation: bounceInFromTop 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .fake-placeholder.animation-1-out {
    animation: bounceOutToBottom 0.5s cubic-bezier(0.55, 0.085, 0.68, 0.53);
  }

  .fake-placeholder.animation-2-in {
    animation: slideInFromLeft 0.7s cubic-bezier(0.34, 1.2, 0.64, 1);
  }

  .fake-placeholder.animation-2-out {
    animation: slideOutToRight 0.4s cubic-bezier(0.55, 0.085, 0.68, 0.53);
  }

  .fake-placeholder.animation-3-in {
    animation: scalePopIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  .fake-placeholder.animation-3-out {
    animation: scalePopOut 0.5s cubic-bezier(0.6, 0.04, 0.98, 0.335);
  }

  .search-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--brand);
    border: none;
    padding: 5px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    transition: var(--transition);
  }

  .search-btn:hover {
    background: #d97706;
  }

  .search-btn:focus {
    outline: 2px solid var(--brand);
    outline-offset: 2px;
  }

  /* Search Results */
  .search-results {
    display: none;
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: var(--radius);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    max-height: 500px;
    overflow-y: auto;
    z-index: 1001;
  }

  .search-results.active {
    display: block;
  }

  .search-result-item {
    display: flex;
    align-items: center;
    padding: 12px;
    border-bottom: 1px solid #f3f4f6;
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    color: var(--dark);
    gap: 12px;
  }

  .search-result-item:last-child {
    border-bottom: none;
  }

  .search-result-item:hover,
  .search-result-item:focus {
    background: #f9fafb;
    outline: 2px solid var(--brand);
    outline-offset: -2px;
  }

  .search-result-image-wrapper {
    width: 60px;
    height: 60px;
    flex-shrink: 0;
    border-radius: 8px;
    overflow: hidden;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
  }

  .search-result-image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
  }

  .search-result-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
  }

  .search-result-name {
    font-weight: 600;
    font-size: 14px;
    color: var(--dark);
    line-height: 1.3;
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
  }

  .search-result-status {
    display: inline-block;
    padding: 2px 6px;
    background: #10b981;
    color: white;
    font-size: 10px;
    font-weight: 600;
    border-radius: 3px;
    white-space: nowrap;
  }

  .search-result-price {
    font-size: 13px;
    color: var(--brand);
    font-weight: 700;
  }

  .no-results {
    padding: 24px;
    text-align: center;
    color: var(--gray);
    font-size: 14px;
  }

  /* Top Actions */
  .top-actions {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .phone-link {
    display: flex;
    align-items: center;
    gap: 8px;
    background: none;
    color: var(--dark);
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 8px;
    transition: var(--transition);
    font-weight: 500;
    font-size: 14px;
  }

  .phone-link:hover,
  .phone-link:focus {
    background: #f3f4f6;
    outline: 2px solid var(--brand);
    outline-offset: 2px;
  }

  .phone-number {
    white-space: nowrap;
  }

  .delivery-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #10b981;
    color: white;
    padding: 8px 14px;
    border-radius: var(--radius);
    font-size: 13px;
    font-weight: 600;
    box-shadow: 0 3px 8px rgba(16, 185, 129, 0.25);
  }

  /* Bottom Nav */
  .navbar-bottom {
    background: var(--light);
  }

  .nav-menu {
    list-style: none;
    display: flex;
    gap: 28px;
  }

  .nav-menu a {
    text-decoration: none;
    color: var(--gray);
    font-weight: 500;
    padding: 10px 0;
    position: relative;
    transition: var(--transition);
    display: block;
  }

  .nav-menu a::after {
    content: "";
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--brand);
    transition: var(--transition);
  }

  .nav-menu a:hover,
  .nav-menu a:focus,
  .nav-menu a.active {
    color: var(--brand);
    outline: none;
  }

  .nav-menu a:hover::after,
  .nav-menu a:focus::after,
  .nav-menu a.active::after {
    width: 100%;
  }

  /* Cart */
  .cart-btn {
    position: relative;
    background: var(--brand);
    border: none;
    padding: 8px 10px;
    border-radius: var(--radius);
    color: white;
    cursor: pointer;
    transition: var(--transition);
  }

  .cart-btn:hover {
    background: #d97706;
    transform: translateY(-2px);
  }

  .cart-btn:focus {
    outline: 2px solid var(--brand);
    outline-offset: 2px;
  }

  .cart-count {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #ef4444;
    color: white;
    font-size: 11px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 999px;
    min-width: 18px;
    text-align: center;
  }

  /* Mobile Menu */
  .mobile-menu {
    position: fixed;
    top: 0;
    left: -100%;
    width: 280px;
    height: 100vh;
    background: white;
    box-shadow: 2px 0 12px rgba(0, 0, 0, 0.08);
    transition: left var(--transition);
    z-index: 2000;
  }

  .mobile-menu.active {
    left: 0;
  }

  .mobile-menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px 20px;
    border-bottom: 1px solid #e5e7eb;
  }

  .mobile-menu-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--dark);
    margin: 0;
  }

  .close-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    color: var(--dark);
    transition: var(--transition);
  }

  .close-btn:hover,
  .close-btn:focus {
    color: var(--brand);
    outline: 2px solid var(--brand);
    outline-offset: 2px;
    border-radius: 4px;
  }

  .mobile-nav-links {
    list-style: none;
    padding: 16px 0;
  }

  .mobile-nav-links a {
    display: block;
    padding: 14px 24px;
    color: var(--dark);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
  }

  .mobile-nav-links a:hover,
  .mobile-nav-links a:focus {
    background: #f3f4f6;
    color: var(--brand);
    padding-left: 32px;
    outline: none;
  }

  .menu-btn {
    display: none;
  }

  .search-mobile {
    display: none;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .navbar-top .container {
      padding: 10px 12px;
      gap: 8px;
    }

    .menu-btn {
      display: flex;
      flex-direction: column;
      gap: 4px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 6px;
      flex-shrink: 0;
    }

    .menu-btn:focus {
      outline: 2px solid var(--brand);
      outline-offset: 2px;
      border-radius: 4px;
    }

    .hamburger {
      width: 20px;
      height: 2px;
      background: var(--dark);
      border-radius: 2px;
    }

    .logo {
      flex-shrink: 0;
    }

    .logo-img {
      width: 40px;
      height: 40px;
    }

    .top-actions {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
      margin-left: auto;
    }

    .phone-link {
      padding: 6px 8px;
      background: var(--light);
      border-radius: 6px;
    }

    .phone-link svg {
      width: 18px;
      height: 18px;
    }

    .phone-number {
      display: inline;
      font-size: 12px;
    }

    .delivery-badge {
      padding: 6px 8px;
      font-size: 11px;
    }

    .delivery-badge svg {
      width: 16px;
      height: 16px;
    }

    .delivery-badge span {
      display: none;
    }

    .navbar-top .search-container {
      display: none;
    }

    .search-mobile {
      display: block;
      flex: 1;
      max-width: 100%;
    }

    .nav-menu {
      display: none;
    }

    .navbar-bottom .container {
      padding: 10px 12px;
      gap: 10px;
    }

    .search-input {
      padding: 9px 42px 9px 12px;
      font-size: 13px;
    }

    .fake-placeholder {
      font-size: 13px;
      left: 12px;
    }

    .search-btn {
      padding: 6px;
    }

    .search-result-item {
      padding: 10px;
      gap: 10px;
    }

    .search-result-image-wrapper {
      width: 50px;
      height: 50px;
    }

    .search-result-name {
      font-size: 13px;
    }

    .search-result-price {
      font-size: 12px;
    }

    .cart-btn {
      padding: 10px 12px;
      flex-shrink: 0;
    }

    .cart-btn svg {
      width: 20px;
      height: 20px;
    }
  }

  @media (max-width: 380px) {
    .navbar-top .container {
      gap: 6px;
      padding: 10px 8px;
    }

    .menu-btn {
      padding: 4px;
    }

    .logo-img {
      width: 36px;
      height: 36px;
    }

    .phone-link {
      padding: 5px 6px;
    }

    .phone-link svg {
      width: 16px;
      height: 16px;
    }

    .phone-number {
      font-size: 11px;
    }

    .delivery-badge {
      padding: 5px 6px;
    }

    .delivery-badge svg {
      width: 14px;
      height: 14px;
    }

    .cart-btn {
      padding: 8px 10px;
    }

    .cart-btn svg {
      width: 18px;
      height: 18px;
    }

    .search-result-image-wrapper {
      width: 45px;
      height: 45px;
    }
  }
</style>

<script>
  import { products } from "../data/product2";

  interface Product {
    id: number;
    name: string;
    status: string;
    image: string;
    from: string;
    totalPrice: string;
    slug: string;
    source: string;
  }

  // Add this script to your Nav.astro component or in a <script> tag

  document.addEventListener("DOMContentLoaded", () => {
    // Initialize cart count on page load
    if (window.cartManager) {
      window.cartManager.updateCartUI();
    }

    // Listen for cart updates
    window.addEventListener("cartUpdated", (e) => {
      const count = e.detail.count;
      const cartCountElements = document.querySelectorAll(".cart-count");

      cartCountElements.forEach((el) => {
        el.textContent = count;
        el.style.display = count > 0 ? "block" : "none";
      });
    });
  });

  // === FAKE PLACEHOLDER ROTATOR WITH DIFFERENT ANIMATIONS ===
  class FakePlaceholderRotator {
    private elements: Array<{
      input: HTMLInputElement;
      fakePlaceholder: HTMLElement;
    }> = [];
    private placeholders: string[] = [
      "Search phones on credit...",
      "Buy phone on credit",
      "Choose the best phone..",
    ];
    private currentIndex: number = 0;
    private interval: number = 3000;
    private timer: number | null = null;

    constructor(configs: Array<{ inputId: string; placeholderId: string }>) {
      this.init(configs);
    }

    private init(
      configs: Array<{ inputId: string; placeholderId: string }>
    ): void {
      configs.forEach((config) => {
        const input = document.getElementById(
          config.inputId
        ) as HTMLInputElement | null;
        const fakePlaceholder = document.getElementById(
          config.placeholderId
        ) as HTMLElement | null;

        if (input && fakePlaceholder) {
          this.elements.push({ input, fakePlaceholder });
          fakePlaceholder.textContent = this.placeholders[0];
          input.addEventListener("focus", () => this.pause());
          input.addEventListener("blur", () => this.startRotation());
        }
      });

      if (this.elements.length === 0) return;
      this.startRotation();
    }

    private setPlaceholder(index: number): void {
      const text = this.placeholders[index];
      const animationIndex = (index % 3) + 1;

      this.elements.forEach(({ input, fakePlaceholder }) => {
        if (document.activeElement !== input && input.value === "") {
          fakePlaceholder.classList.remove(
            "animation-1-in",
            "animation-1-out",
            "animation-2-in",
            "animation-2-out",
            "animation-3-in",
            "animation-3-out"
          );

          fakePlaceholder.classList.add(`animation-${animationIndex}-out`);

          const outDuration =
            animationIndex === 1 ? 500 : animationIndex === 2 ? 400 : 500;

          setTimeout(() => {
            fakePlaceholder.textContent = text;
            fakePlaceholder.classList.remove(`animation-${animationIndex}-out`);
            fakePlaceholder.classList.add(`animation-${animationIndex}-in`);

            const inDuration =
              animationIndex === 1 ? 700 : animationIndex === 2 ? 700 : 800;
            setTimeout(() => {
              fakePlaceholder.classList.remove(
                `animation-${animationIndex}-in`
              );
            }, inDuration);
          }, outDuration);
        }
      });
    }

    private next(): void {
      this.currentIndex = (this.currentIndex + 1) % this.placeholders.length;
      this.setPlaceholder(this.currentIndex);
    }

    private startRotation(): void {
      this.pause();
      this.timer = window.setInterval(() => this.next(), this.interval);
    }

    private pause(): void {
      if (this.timer !== null) {
        clearInterval(this.timer);
        this.timer = null;
      }
    }
  }

  // === ORIGINAL NAV LOGIC ===
  const menuBtn = document.getElementById(
    "menuBtn"
  ) as HTMLButtonElement | null;
  const mobileMenu = document.getElementById(
    "mobileMenu"
  ) as HTMLDivElement | null;
  const closeBtn = document.getElementById(
    "closeBtn"
  ) as HTMLButtonElement | null;

  const searchInput = document.getElementById(
    "searchInput"
  ) as HTMLInputElement | null;
  const searchBtn = document.getElementById(
    "searchBtn"
  ) as HTMLButtonElement | null;
  const searchResults = document.getElementById(
    "searchResults"
  ) as HTMLDivElement | null;

  const searchInputMobile = document.getElementById(
    "searchInputMobile"
  ) as HTMLInputElement | null;
  const searchBtnMobile = document.getElementById(
    "searchBtnMobile"
  ) as HTMLButtonElement | null;
  const searchResultsMobile = document.getElementById(
    "searchResultsMobile"
  ) as HTMLDivElement | null;

  const cartBtn = document.getElementById(
    "cartBtn"
  ) as HTMLButtonElement | null;

  // Mobile menu handlers
  menuBtn?.addEventListener("click", () => {
    const isActive = mobileMenu?.classList.toggle("active");
    menuBtn?.setAttribute("aria-expanded", String(isActive));
    mobileMenu?.setAttribute("aria-hidden", String(!isActive));
  });

  closeBtn?.addEventListener("click", () => {
    mobileMenu?.classList.remove("active");
    menuBtn?.setAttribute("aria-expanded", "false");
    mobileMenu?.setAttribute("aria-hidden", "true");
  });

  document.addEventListener("click", (e: MouseEvent) => {
    const target = e.target as Node;
    if (
      mobileMenu?.classList.contains("active") &&
      !mobileMenu.contains(target) &&
      menuBtn &&
      !menuBtn.contains(target)
    ) {
      mobileMenu.classList.remove("active");
      menuBtn?.setAttribute("aria-expanded", "false");
      mobileMenu?.setAttribute("aria-hidden", "true");
    }
  });

  // Search function
  function performSearch(
    query: string,
    resultsContainer: HTMLDivElement
  ): void {
    if (!query.trim()) {
      resultsContainer.classList.remove("active");
      return;
    }

    const filtered = (products as Product[]).filter((product: Product) =>
      product.name.toLowerCase().includes(query.toLowerCase())
    );

    if (filtered.length === 0) {
      resultsContainer.innerHTML =
        '<div class="no-results" role="status">No products found</div>';
      resultsContainer.classList.add("active");
      return;
    }

    const html: string = filtered
      .map(
        (product: Product) => `
          <a href="/product/${product.slug}" class="search-result-item" role="option">
            <div class="search-result-image-wrapper">
              <img src="${product.source}" alt="${product.name}" loading="lazy" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2260%22 height=%2260%22%3E%3Crect fill=%22%23f3f4f6%22 width=%2260%22 height=%2260%22/%3E%3C/svg%3E'">
            </div>
            <div class="search-result-info">
              <div class="search-result-name">
                ${product.name}
                <span class="search-result-status">${product.status}</span>
              </div>
              <div class="search-result-price">${product.totalPrice}</div>
            </div>
          </a>
        `
      )
      .join("");

    resultsContainer.innerHTML = html;
    resultsContainer.classList.add("active");
  }

  // Desktop search handlers
  searchInput?.addEventListener("input", (e: Event) => {
    const target = e.target as HTMLInputElement;
    if (searchResults) {
      performSearch(target.value, searchResults);
    }
  });

  searchBtn?.addEventListener("click", () => {
    if (searchInput && searchResults) {
      performSearch(searchInput.value, searchResults);
    }
  });

  searchInput?.addEventListener("keypress", (e: KeyboardEvent) => {
    if (e.key === "Enter" && searchResults) {
      performSearch(searchInput.value, searchResults);
    }
  });

  // Mobile search handlers
  searchInputMobile?.addEventListener("input", (e: Event) => {
    const target = e.target as HTMLInputElement;
    if (searchResultsMobile) {
      performSearch(target.value, searchResultsMobile);
    }
  });

  searchBtnMobile?.addEventListener("click", () => {
    if (searchInputMobile && searchResultsMobile) {
      performSearch(searchInputMobile.value, searchResultsMobile);
    }
  });

  searchInputMobile?.addEventListener("keypress", (e: KeyboardEvent) => {
    if (e.key === "Enter" && searchInputMobile && searchResultsMobile) {
      performSearch(searchInputMobile.value, searchResultsMobile);
    }
  });

  // Close search results when clicking outside
  document.addEventListener("click", (e: MouseEvent) => {
    const target = e.target as HTMLElement;
    if (!target.closest(".search-container")) {
      searchResults?.classList.remove("active");
      searchResultsMobile?.classList.remove("active");
    }
  });

  // Update cart button aria-label when cart count changes
  // function updateCartCount(count: number): void {
  //   const cartCount = document.querySelector(".cart-count");
  //   if (cartCount) {
  //     cartCount.textContent = String(count);
  //   }
  //   cartBtn?.setAttribute(
  //     "aria-label",
  //     `View shopping cart with ${count} ${count === 1 ? "item" : "items"}`
  //   );
  // }

  // Keyboard navigation for search results
  function setupKeyboardNavigation(
    input: HTMLInputElement,
    resultsContainer: HTMLDivElement
  ): void {
    input.addEventListener("keydown", (e: KeyboardEvent) => {
      const items = resultsContainer.querySelectorAll(".search-result-item");
      const activeElement = document.activeElement;
      const currentIndex = Array.from(items).indexOf(activeElement as Element);

      if (e.key === "ArrowDown") {
        e.preventDefault();
        if (currentIndex < items.length - 1) {
          (items[currentIndex + 1] as HTMLElement).focus();
        } else if (currentIndex === -1 && items.length > 0) {
          (items[0] as HTMLElement).focus();
        }
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        if (currentIndex > 0) {
          (items[currentIndex - 1] as HTMLElement).focus();
        } else if (currentIndex === 0) {
          input.focus();
        }
      } else if (e.key === "Escape") {
        resultsContainer.classList.remove("active");
        input.value = "";
      }
    });
  }

  // Setup keyboard navigation for both search inputs
  if (searchInput && searchResults) {
    setupKeyboardNavigation(searchInput, searchResults);
  }
  if (searchInputMobile && searchResultsMobile) {
    setupKeyboardNavigation(searchInputMobile, searchResultsMobile);
  }

  // Handle escape key to close mobile menu
  document.addEventListener("keydown", (e: KeyboardEvent) => {
    if (e.key === "Escape" && mobileMenu?.classList.contains("active")) {
      mobileMenu.classList.remove("active");
      menuBtn?.setAttribute("aria-expanded", "false");
      mobileMenu?.setAttribute("aria-hidden", "true");
      menuBtn?.focus();
    }
  });

  // === INITIALIZE PLACEHOLDER ROTATOR ===
  document.addEventListener("DOMContentLoaded", () => {
    new FakePlaceholderRotator([
      { inputId: "searchInput", placeholderId: "fakePlaceholder" },
      { inputId: "searchInputMobile", placeholderId: "fakePlaceholderMobile" },
    ]);
  });
</script>
