---
import ProductCard from "./ProductCard.astro";
import { products } from "../data/products.js";
---

<style is:inline>
  :root {
    --dark-color: #161616;
    --smaller-font-size: 0.75rem;
    --accent-color: #ff5151;
  }

  body {
    margin: 2rem 0 0 0;
    background-color: #fff;
    color: var(--dark-color);
    width: 100vw;
    overflow-x: hidden;
  }

  img {
    max-width: 100%;
    height: auto;
  }

  .main {
    padding: 2rem 0;
  }

  /* Step-by-step carousel styles */
  .carousel-container {
    max-width: 1200px;
    margin: 0 2.5rem;
    overflow: hidden;
    position: relative;
  }

  .carousel-track {
    display: flex;
    gap: 2rem;
    transition: transform 0.5s ease-in-out;
  }

  .carousel-item {
    flex: 0 0 auto;
    width: calc((100% - 8rem) / 5); /* 5 products on desktop minus gaps */
    min-width: 180px;
  }

  /* Responsive product display */
  @media (max-width: 1024px) {
    .carousel-item {
      width: calc((100% - 6rem) / 4); /* 4 products on tablet */
    }
  }

  @media (max-width: 768px) {
    .carousel-item {
      width: calc((100% - 4rem) / 3); /* 3 products on small tablet */
    }

    .carousel-container {
      margin: 0 1rem;
    }
  }

  @media (max-width: 480px) {
    .carousel-item {
      width: calc((100% - 2rem) / 2); /* 2 products on mobile */
    }
  }

  @media (max-width: 320px) {
    .carousel-item {
      width: 100%; /* 1 product on very small mobile */
    }
  }

  .whatsapp {
    width: 100px;
    height: 50px;
    position: fixed;
    bottom: 20px;
    right: 10px;
    padding: 12px 15px;
    border-radius: 20px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    z-index: 999;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
  }

  .message {
    display: flex;
    width: 60px;
  }

  .message h1 {
    font-size: 10px;
    margin: auto;
  }

  footer {
    text-align: center;
    margin-top: 3rem;
    padding: 2rem;
    color: var(--dark-color);
    opacity: 0.7;
  }

  footer a {
    color: var(--dark-color);
    transition: color 0.3s ease;
  }

  footer a:hover {
    color: var(--accent-color);
  }

  @media screen and (min-width: 1200px) {
    body {
      margin: 3rem 0 0 0;
    }
    .carousel-container {
      margin-left: auto;
      margin-right: auto;
    }
  }
</style>

<main class="main">
  <div class="carousel-container">
    <div class="carousel-track" id="carousel-track">
      {
        products.map((product, index) => (
          <div class="carousel-item">
            <ProductCard {...product} index={index} />
          </div>
        ))
      }
    </div>
  </div>

  <div class="whatsapp">
    <a
      href="https://wa.me/254762790513?text=Hello%2C%20I'm%20interested%20in%20your%20products"
      target="_blank"
      rel="noopener noreferrer"
      style="background-color: #25D366; color: white; padding: 8px 12px; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.2); font-size: 24px; z-index: 999;"
      aria-label="Chat with us on WhatsApp"
    >
    </a>

    <div class="message">
      <h1>Chat</h1>
    </div>
  </div>
</main>

<script define:vars={{ totalProducts: products.length }}>
  document.addEventListener("DOMContentLoaded", function () {
    const track = document.getElementById("carousel-track");
    let currentIndex = 0;

    function getProductsPerView() {
      const width = window.innerWidth;
      if (width <= 320) return 1; // Very small mobile: 1 product
      if (width <= 480) return 2; // Mobile: 2 products
      if (width <= 768) return 3; // Small tablet: 3 products
      if (width <= 1024) return 4; // Tablet: 4 products
      return 5; // Desktop: 5 products
    }

    function moveToNext() {
      const productsPerView = getProductsPerView();
      const maxIndex = Math.max(0, totalProducts - productsPerView);

      currentIndex = currentIndex >= maxIndex ? 0 : currentIndex + 1;

      const itemWidth = track.children[0].offsetWidth + 32; // width + gap
      const translateX = -currentIndex * itemWidth;

      if (track) {
        track.style.transform = `translateX(${translateX}px)`;
      }
    }

    // Move to next product every 4 seconds (3.5s viewing + 0.5s transition)
    setInterval(moveToNext, 4000);

    // Recalculate on window resize
    window.addEventListener("resize", function () {
      currentIndex = 0;
      if (track) {
        track.style.transform = "translateX(0px)";
      }
    });
  });
</script>

<footer>
  <a>Copyright @2025. All rights reserved</a>
</footer>
